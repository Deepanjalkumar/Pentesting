#!/bin/bash

#Taking domain as first input

domain=$1
resolvers="/root/30resolvers.txt"
dnsresolvers="/root/massdns/lists/resolvers.txt"
wordlist1="/root/Amass/examples/wordlists/all.txt"
wordlist2="/root/Amass/examples/wordlists/subdomains.txt"
wordlist3="/root/Amass/examples/wordlists/subdomains-top1mil-5000.txt"
wordlist4="/root/Amass/examples/wordlists/subdomains-top1mil-20000.txt"
wordlist5="/root/Amass/examples/wordlists/subdomains-top1mil-110000.txt"
wordlist6="/root/Amass/examples/wordlists/subdomains.lst"
wordlist7="/root/Amass/examples/wordlists/sorted_knock_dnsrecon_fierce_recon-ng.txt"
wordlist8="/root/Amass/examples/wordlists/jhaddix_all.txt"
wordlist9="/root/Amass/examples/wordlists/fierce_hostlist.txt"
wordlist10="/root/Amass/examples/wordlists/deepmagic.com_top50kprefixes.txt"
alterationwords1="/root/go-workspace/src/github.com/subfinder/goaltdns/words.txt"
alterationwords2="/root/go-workspace/src/github.com/subfinder/goaltdns/words2.txt"
###################################################################################################################################

final_enum(){

#Making Directory to keep all things sorted

mkdir -p $domain $domain/sources $domain/recon $domain/resolve $domain/output  $domain/web $domain/urls $domain/liveurls $domain/spidering $domain/mega
##############################################################################################################################################################
#Using Assetfinder to find subdomain from seed-domain

assetfinder -subs-only $domain | tee $domain/sources/domains.txt
cat $domain/sources/domains.txt | sort -u | tee $domain/sources/domains.txt

#####################################################################333333333333###########################################################################
#Using subfinder

subfinder -d $domain -nW -v -rL $resolvers -o $domain/sources/subfinder.txt
cat $domain/sources/subfinder.txt | sort -u | tee $domain/sources/subfinder.txt
##############################################################################################################################################################
#Using Sublist3r

python /root/Sublist3r/sublist3r.py -d $domain -b -t 50 -p 80,443,8080  -o $domain/sources/sublist3r.txt
cat $domain/sources/sublist3r.txt | sort -u | tee $domain/sources/sublist3r.txt
##############################################################################################################################################################
#Using Chaos

chaos -d $domain -key 6b12369ec4831a265ba9f6bf1ed2b5452da0b88b53dba181616cb39a0c8b61f4 | tee $domain/sources/chaos.txt
cat $domain/sources/chaos.txt | sort -u | tee $domain/sources/chaos.txt
#############################################################################################################################################################
#Using metabigor

echo $domain | metabigor net --accurate --domain -v -o $domain/sources/metabigor_domain_enum.txt
cat $domain/sources/metabigor_domain_enum.txt | sort -u | tee $domain/sources/metabigor_domain_enum.txt
##############################################################################################################################################################
#Using Amass

amass enum -src -passive  -rf $resolvers -max-dns-queries 20000 -d $domain -o $domain/sources/amass_enum_passive.txt
cat $domain/sources/amass_enum_passive.txt | awk -F " " '{print $2}' | tee $domain/sources/amass_enum_passive.txt
cat $domain/sources/amass_enum_passive.txt | sort -u | tee $domain/sources/amass_enum_passive.txt

amass enum -src -active  -rf $resolvers -max-dns-queries 20000 -d $domain -o $domain/sources/amass_enum_active.txt
cat $domain/sources/amass_enum_active.txt | awk -F " " '{print $2}'| tee $domain/sources/amass_enum_active.txt
cat $domain/sources/amass_enum_active.txt | sort -u | tee $domain/sources/amass_enum_active.txt

amass intel -src -active -rf $resolvers -max-dns-queries 20000 -d $domain -whois -o $domain/sources/amass_intel_active.txt
cat $domain/sources/amass_intel_active.txt | awk -F " " '{print $2}' | tee $domain/sources/amass_intel_active.txt
cat $domain/sources/amass_intel_active.txt | sort -u |tee  $domain/sources/amass_intel_active.txt
###############################################################################################################################################################
#Domain brute force using Shuffledns

shuffledns  -d $domain -w $wordlist1 -r $dnsresolvers -o $domain/sources/shuffledns_domain1_brute_all.txt
cat $domain/sources/shuffledns_domain1_brute_all.txt | sort -u | tee $domain/sources/shuffledns_domain1_brute_all.txt

shuffledns  -d $domain -w $wordlist2 -r $dnsresolvers -o $domain/sources/shuffledns_domain_brute_subdomains.txt
cat $domain/sources/shuffledns_domain_brute_subdomains.txt | sort -u | tee $domain/sources/shuffledns_domain_brute_subdomains.txt

shuffledns  -d $domain -w $wordlist3 -r $dnsresolvers -o $domain/sources/shuffledns_domain_brute_subdomains-top1mil-5000.txt
cat $domain/sources/shuffledns_domain_brute_subdomains-top1mil-5000.txt | sort -u | tee $domain/sources/shuffledns_domain_brute_subdomains-top1mil-5000.txt

shuffledns  -d $domain -w $wordlist4 -r $dnsresolvers -o $domain/sources/shuffledns_domain_brute_subdomains-top1mil-20000.txt
cat $domain/sources/shuffledns_domain_brute_subdomains-top1mil-20000.txt | sort -u | tee $domain/sources/shuffledns_domain_brute_subdomains-top1mil-20000.txt

shuffledns  -d $domain -w $wordlist5 -r $dnsresolvers -o $domain/sources/shuffledns_domain_brute_subdomains-top1mil-110000.txt
cat $domain/sources/shuffledns_domain_brute_subdomains-top1mil-110000.txt | sort -u | tee $domain/sources/shuffledns_domain_brute_subdomains-top1mil-110000.txt

shuffledns  -d $domain -w $wordlist6 -r $dnsresolvers -o $domain/sources/shuffledns_domain_brute_subdomains_lst.txt
cat $domain/sources/shuffledns_domain_brute_subdomains_lst.txt | sort -u | tee $domain/sources/shuffledns_domain_brute_subdomains_lst.txt

shuffledns  -d $domain -w $wordlist7 -r $dnsresolvers -o $domain/sources/shuffledns_domain_brute_sorted_knock_dnsrecon_fierce_recon-ng.txt
cat $domain/sources/shuffledns_domain_brute_sorted_knock_dnsrecon_fierce_recon-ng.txt | sort -u | tee $domain/sources/shuffledns_domain_brute_sorted_knock_dnsrecon_fierce_recon-ng.txt

shuffledns  -d $domain -w $wordlist8 -r $dnsresolvers -o $domain/sources/shuffledns_domain_brute_jhaddix_all.txt
cat $domain/sources/shuffledns_domain_brute_jhaddix_all.txt | sort -u | tee $domain/sources/shuffledns_domain_brute_jhaddix_all.txt

shuffledns  -d $domain -w $wordlist9 -r $dnsresolvers -o $domain/sources/shuffledns_domain_brute_fierce_hostlist.txt
cat $domain/sources/shuffledns_domain_brute_fierce_hostlist.txt | sort -u | tee $domain/sources/shuffledns_domain_brute_fierce_hostlist.txt

shuffledns  -d $domain -w $wordlist10 -r $dnsresolvers -o $domain/sources/shuffledns_domain_brute_deepmagic.com_top50kprefixes.txt
cat $domain/sources/shuffledns_domain_brute_deepmagic.com_top50kprefixes.txt | sort -u | tee $domain/sources/shuffledns_domain_brute_deepmagic.com_top50kprefixes.txt 

################################################################################################################################################################
#Domain Alteration and permutation using goaltdns

goaltdns -h $domain -w $alterationwords1 -o $domain/sources/goaltdns1.txt

goaltdns -h $domain -w $alterationwords2 -o $domain/sources/goaltdns2.txt
################################################################################################################################################################
#Directing all the domains to $domain/recon directory

cat $domain/sources/*.txt > $domain/recon/alldomain.txt

########################################################################################################################################################


#Checking if the sub-domains have web service running

cat $domain/recon/alldomain.txt | httpx | tee $domain/web/httpx.txt
cat $domain/web/httpx.txt | sort -u | tee $domain/web/httpx.txt

cat $domain/recon/alldomain.txt | httprobe | tee $domain/web/httprobe.txt
cat $domain/web/httprobe.txt | sort -u | tee $domain/web/httprobe.txt

cat $domain/web/httpx.txt $domain/web/httprobe.txt > $domain/web/web.txt
cat $domain/web/web.txt | sort -u | tee $domain/web/web.txt
###############################################################################################################################################################
#Getting all the urls from web services running

cat $domain/web/web.txt | gau | tee $domain/urls/gau.txt
cat $domain/urls/gau.txt | sort -u | tee $domain/urls/gau.txt

cat $domain/web/web.txt | waybackurls |  tee $domain/urls/waybackurls.txt
cat $domain/urls/waybackurls.txt | sort -u | tee $domain/urls/waybackurls.txt

cat $domain/urls/gau.txt $domain/urls/waybackurls.txt > $domain/urls/urls.txt
cat $domain/urls/urls.txt | sort -u | tee $domain/urls/urls.txt

################################################################################################################################################################
#Checking if urls are running or dead

gowitness file -f /root/$domain/urls/urls.txt report
gowitness report list | sort -u | awk -F "|" '{print $2}' | tee $domain/liveurls/gowitness_all.txt
gowitness report list | sort -u | grep 200 | awk -F "|" '{print $2}' | tee $domain/liveurls/gowitness_2XX.txt
cat $domain/liveurls/gowitness_2XX.txt | awk -F " " '{print $1}'| tee $domain/liveurls/gowitness_2XX.txt
gowitness report list | sort -u | grep 403 | awk -F "|" '{print $2}' | tee $domain/liveurls/gowitness_4XX.txt
cat $domain/liveurls/gowitness_4XX.txt | awk -F " " '{print $1}'| tee $domain/liveurls/gowitness_4XX.txt

#Spidering the websites 

gospider -S $domain/liveurls/gowitness_2XX.txt  -c 10 -d 1 --other-source --blacklist  ".(jpg|jpeg|gif|css|tif|tiff|png|ttf|woff|woff2|ico)" -t 10 -o   $domain/spidering/gospider
cat $domain/spidering/gospider/* | sort -u | tee $domain/spidering/gospider_all.txt
cat $domain/spidering/gospider/* | grep javascript | tee $domain/spidering/gospider_javascript.txt
cat $domain/spidering/gospider_javascript.txt | awk -F "- " '{print $2,$3,$4,$5,$6,$7,$8,$9}'| tee $domain/spidering/gospider_javascript_final.txt 
cat $domain/spidering/gospider/* | grep linkfinder | tee $domain/spidering/gospider_linkfinder.txt
cat $domain/spidering/gospider_linkfinder.txt |awk -F "- "  '{print $2,$3,$4,$5,$6,$7,$8,$9}'| tee $domain/spidering/gospider_linkfinder_final.txt 
cat $domain/spidering/gospider/* | grep subdomains | tee $domain/spidering/gospider_subdomains.txt
cat $domain/spidering/gospider_subdomains.txt | awk -F "- " '{print $2,$3,$4,$5,$6,$7,$8,$9}'| tee $domain/spidering/gospider_subdomains_final.txt
cat $domain/spidering/gospider/* | grep code- | tee $domain/spidering/gospider_url.txt
cat $domain/spidering/gospider_url.txt | grep code-200 | awk -F "- " '{print $3,$4,$5,$6,$7,$8,$9,$10}' | tee $domain/spidering/gospider_url_200.txt
cat $domain/spidering/gospider_url.txt | grep code-403 | awk -F "- " '{print $3,$4,$5,$6,$7,$8,$9,$10}' | tee $domain/spidering/gospider_url_403.txt
##############################################################################################################################################################

cat $domain/liveurls/gowitness_2XX.txt | hakrawler -all -depth 4 | tee $domain/spidering/hakrawler_all.txt
cat $domain/spidering/hakrawler_all.txt | grep url | tee $domain/spidering/hakrawler_url.txt
cat $domain/spidering/hakrawler_url.txt | awk -F " " '{print $2}'| tee $domain/spidering/hakrawler_url.txt
cat $domain/spidering/hakrawler_all.txt | grep javascript | tee $domain/spidering/hakrawler_javascript.txt
cat $domain/spidering/hakrawler_javascript.txt | awk -F " " '{print $2}'| tee $domain/spidering/hakrawler_javascript.txt
cat $domain/spidering/hakrawler_all.txt | grep sitemap | tee $domain/spidering/hakrawler_sitemap.txt
cat $domain/spidering/hakrawler_sitemap.txt | awk -F " " '{print $2}'|tee $domain/spidering/hakrawler_sitemap.txt
cat $domain/spidering/hakrawler_all.txt | grep subdomain | tee $domain/spidering/hakrawler_subdomain.txt
cat $domain/spidering/hakrawler_subdomain.txt | awk -F " " '{print $2}'|tee $domain/spidering/hakrawler_subdomain.txt
cat $domain/spidering/hakrawler_all.txt | grep form | tee $domain/spidering/hakrawler_form.txt
cat $domain/spidering/hakrawler_form.txt | awk -F " " '{print $2}'|tee $domain/spidering/hakrawler_form.txt
cat $domain/spidering/hakrawler_all.txt | grep robots | tee $domain/spidering/hakrawler_robots.txt
cat $domain/spidering/hakrawler_robots.txt | awk -F " " '{print $2}'|tee $domain/spidering/hakrawler_robots.txt

#####################################################################################################################################################################
#Combine all the files into their following types

cat $domain/spidering/gospider_javascript_final.txt   $domain/spidering/hakrawler_javascript.txt > $domain/mega/mega_javascript.txt
cat $domain/mega/mega_javascript.txt | sort -u | tee $domain/mega/mega_javascript.txt
cat $domain/spidering/gospider_url_200.txt  $domain/spidering/hakrawler_url.txt > $domain/mega/mega_url.txt
cat $domain/mega/mega_url.txt | sort -u | tee $domain/mega/mega_url.txt
cat $domain/spidering/gospider_subdomains_final.txt  $domain/spidering/hakrawler_subdomain.txt > $domain/mega/mega_subdomain.txt
cat $domain/mega/mega_subdomain.txt | sort -u | tee $domain/mega/mega_subdomain.txt

figlet Task-Completed

}

final_enum
